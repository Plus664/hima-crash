
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="screen-orientation" content="landscape">
<meta name="x5-orientation" content="landscape">
<title>æš‡ã¤ã¶ã—</title>
<style>
  body { background:#222; color:#fff; font-family:sans-serif; text-align:center; }
  #overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,1); color:#fff;
  display:flex; align-items:center; justify-content:center;
  z-index:9999;
  }
  #overlayContent { text-align:center; }
  #overlay h2 { margin-bottom:20px; }
  #overlay button {
    margin-top:20px; padding:10px 20px; font-size:18px;
  }
  #gameArea { position:relative; width:600px; height:200px; margin:20px auto; background:#333; overflow:hidden; }
  .word {
    position:absolute; top:50%; transform:translateY(-50%);
    font-size:24px; width:30px; text-align:center;
  }
  #plate {
    position:absolute; left:80px; top:50%; transform:translateY(-50%);
    width:60px; height:40px; border:2px solid #ff0; border-radius:50%;
  }
  #hammer {
    position:absolute; left:90px; top:20px; font-size:40px; transition:transform 0.1s;
  }
  #hammer.down { transform:translateY(40px) rotate(-20deg); }
  #hammerBtn {
    margin-top:20px; width:80px; height:80px; border-radius:50%;
    background:#555; color:#fff; font-size:18px; cursor:pointer;
  }
  #restartBtn {
    margin-top:10px; width:100px; height:40px; background:#444; color:#fff; cursor:pointer;
  }
  #score { margin-top:10px; font-size:20px; }
  #message { margin-top:20px; font-size:22px; color:#f66; }
</style>
</head>
<body>
<h1>æš‡ã¤ã¶ã—</h1>
<div id="overlay">
  <div id="overlayContent">
    <h2>éŠã³æ–¹</h2>
    <p>æš‡ã‚’å©ã„ã¦ã‚¹ã‚³ã‚¢ã‚’ç¨¼ã”ã†ï¼</p>
    <p>é¢ç›®,è¦ã‚’ãŸãŸãã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</p>
    <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>
</div>
<div id="gameArea">
  <div id="plate"></div>
  <div id="hammer">ğŸ”¨</div>
</div>
<input type="button" id="hammerBtn" value="ãŸãŸã">
<button id="restartBtn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<div id="score">ã‚¹ã‚³ã‚¢: 0</div>
<div id="message"></div>

<script>
let score = 0;
let speed = 2;
let gameOver = false;
const gameArea = document.getElementById("gameArea");
const hammerBtn = document.getElementById("hammerBtn");
const restartBtn = document.getElementById("restartBtn");
const scoreDisplay = document.getElementById("score");
const messageDisplay = document.getElementById("message");
const plate = document.getElementById("plate");
const hammer = document.getElementById("hammer");

let words = [];
let spawnTimeout;

function spawnWord() {
  if (gameOver) return;
  const word = document.createElement("div");
  word.className = "word";

  // å‡ºç¾ç¢ºç‡èª¿æ•´
  const r = Math.random();
  if (r < 0.7) {
    word.textContent = "æš‡";      // 70%
  } else if (r < 0.9) {
    word.textContent = "é¢ç›®";    // 20%
  } else {
    word.textContent = "è¦";      // 10%
  }

  word.style.left = gameArea.offsetWidth + "px";
  gameArea.appendChild(word);

  let pos = gameArea.offsetWidth;
  const interval = setInterval(() => {
    if (gameOver) { clearInterval(interval); return; }
    pos -= speed;
    word.style.left = pos + "px";

    if (pos <= 0) {
      clearInterval(interval);
      gameArea.removeChild(word);
      if (word.textContent === "æš‡") {
        endGame(`æš‡ãŒ${score}æ½°ã‚Œã¾ã—ãŸ`);
      }
    }
  }, 15);

  words.push({el: word, interval: interval});

  // å‡ºç¾é–“éš”ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆã•ã‚‰ã«ç‹­ã‚ï¼‰
  const nextDelay = 500 + Math.random()*300; // 500ã€œ800ms
  spawnTimeout = setTimeout(spawnWord, nextDelay);
}

function endGame(msg) {
  gameOver = true;
  messageDisplay.textContent = msg;
  clearTimeout(spawnTimeout);
}

function shatterWord(wordEl) {
  const text = wordEl.textContent;
  const rect = wordEl.getBoundingClientRect();
  const areaRect = gameArea.getBoundingClientRect();
  const x = rect.left - areaRect.left;
  const y = rect.top - areaRect.top;

  if (wordEl.parentNode) gameArea.removeChild(wordEl);

  for (let i = 0; i < text.length; i++) {
    const span = document.createElement("span");
    span.textContent = text[i];
    span.style.position = "absolute";
    span.style.left = x + i*10 + "px";
    span.style.top = y + "px";
    span.style.fontSize = "24px";
    span.style.color = "#ff0";
    gameArea.appendChild(span);

    const dx = (Math.random() - 0.5) * 200;
    const dy = (Math.random() - 0.5) * 100;
    span.animate([
      { transform: "translate(0,0)", opacity: 1 },
      { transform: `translate(${dx}px, ${dy}px) rotate(${Math.random()*360}deg)`, opacity: 0 }
    ], {
      duration: 800,
      easing: "ease-out",
      fill: "forwards"
    });

    setTimeout(()=>{ if(span.parentNode) gameArea.removeChild(span); }, 900);
  }
}

hammerBtn.onclick = () => {
  if (gameOver) return;
  hammer.classList.add("down");
  setTimeout(()=>{
    hammer.classList.remove("down");
    const plateRect = plate.getBoundingClientRect();
    let hit = false;
    for (let i=0; i<words.length; i++) {
      const w = words[i];
      const rect = w.el.getBoundingClientRect();
      if (!(rect.right < plateRect.left || rect.left > plateRect.right)) {
        hit = true;
        if (w.el.textContent === "æš‡") {
          score += 10;
          scoreDisplay.textContent = "ã‚¹ã‚³ã‚¢: " + score;
          shatterWord(w.el);
          clearInterval(w.interval);
          words.splice(i,1);
        } else if (w.el.textContent === "é¢ç›®") {
          shatterWord(w.el);
          clearInterval(w.interval);
          words.splice(i,1);
          endGame("é¢ç›®ãŒä¸¸æ½°ã‚Œã§ã™");
        } else if (w.el.textContent === "è¦") {
          shatterWord(w.el);
          clearInterval(w.interval);
          words.splice(i,1);
          messageDisplay.style.color = "red";
          endGame("ğŸ¦å‹•ç‰©è™å¾…åå¯¾ï¼ğŸ¦");
        }
        break;
      }
    }
  },80); // ğŸ”¨æŒ¯ã‚Šä¸‹ã‚ã—ã‚’ã•ã‚‰ã«é€Ÿã
};

function startGame() {
  score = 0;
  speed = 2;
  gameOver = false;
  scoreDisplay.textContent = "ã‚¹ã‚³ã‚¢: 0";
  messageDisplay.textContent = "";
  words.forEach(w=>{ clearInterval(w.interval); if(w.el.parentNode) gameArea.removeChild(w.el); });
  words = [];
  spawnWord();
}

restartBtn.onclick = startGame;

function checkOrientation() {
  const overlay = document.getElementById("overlay");
  const overlayContent = document.getElementById("overlayContent");

  if (window.innerHeight > window.innerWidth) {
    // ç¸¦ç”»é¢ãªã‚‰è­¦å‘Šã‚’è¡¨ç¤º
    overlay.style.display = "flex";
    overlayContent.innerHTML =
      "<h2>æ¨ªç”»é¢ã«ã—ã¦ãã ã•ã„</h2><p>ã‚¹ãƒãƒ›ã‚’æ¨ªã«å›ã—ã¦éŠã‚“ã§ã­</p>";
  } else {
    // æ¨ªç”»é¢ãªã‚‰éè¡¨ç¤ºã«æˆ»ã™
    overlay.style.display = "none";
  }
}

window.addEventListener("resize", checkOrientation);
checkOrientation();

document.getElementById("startBtn").onclick = () => {
  document.getElementById("overlay").style.display = "none";
  startGame(); // ã‚²ãƒ¼ãƒ é–‹å§‹é–¢æ•°ã‚’å‘¼ã¶
};
</script>
</body>
</html>
