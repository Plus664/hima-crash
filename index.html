<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="theme-color" content="#222">
  <title>æš‡ã¤ã¶ã—</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #222;
      color: #fff;
      font-family: sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;   /* æ¨ªä¸­å¤® */
      justify-content: center; /* ç¸¦ä¸­å¤® */
    }
    
    h1 {
      margin-top: 10px; /* ã‚¿ã‚¤ãƒˆãƒ«ã‚’å°‘ã—ä¸‹ã’ã‚‹ */
      margin-bottom: 10px;
    }
    
    #gameArea {
      position: relative;
      width: 600px;
      height: 200px;
      background: #333;
      overflow: hidden;
      margin: 0 auto;
    }

    .word {
      position: absolute;
      top: 50%; transform: translateY(-50%);
      font-size: 24px; width: 30px; text-align: center;
    }

    #plate {
      position: absolute;
      left: 80px; top: 50%; transform: translateY(-50%);
      width: 60px; height: 40px;
      border: 2px solid #ff0; border-radius: 50%;
    }

    #hammer {
      position: absolute;
      left: 90px; top: 20px;
      font-size: 40px;
      transition: transform 0.1s;
    }

    #hammer.down { transform: translateY(40px) rotate(-20deg); }

    #hammerBtn {
      position: absolute;
      bottom: 15px;
      left: 15px;
      width: 100px;
      height: 40px;
      font-size: 16px;
      background: #555;
      color: #fff;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      z-index: 10;
    }
    
    #restartBtn {
      position: absolute;
      bottom: 15px;
      right: 15px;
      width: 120px;
      height: 40px;
      font-size: 16px;
      background: #444;
      color: #fff;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      z-index: 10;
    }
    
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 20px;
      z-index: 10;
    }
    
    #message {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 22px;
      color: #f66;
      z-index: 10;
    }

    /* å…±é€šã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    #ruleOverlay, #orientationOverlay {
      position: fixed; top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.9); color:#fff;
      display: none;
      align-items: center; justify-content: center;
      z-index: 9999;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }

    #overlayContent h2 { margin-bottom: 20px; }
    #overlayContent button {
      margin-top: 20px; padding: 10px 20px; font-size: 18px;
    }

    #messageOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    #messageContent {
      text-align: center;
    }
    
    #messageText {
      font-size: 32px;
      color: #f66;
      margin-bottom: 20px;
    }
    
    #overlayRestartBtn {
      width: 120px; height: 40px;
      font-size: 18px;
      background: #444; color: #fff;
      border-radius: 5px; border: none;
      cursor: pointer;
    }

    /* ã‚¹ãƒãƒ›æ¨ªç”»é¢ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆåã¾ã‚Šæœ€å„ªå…ˆï¼‰ */
    @media screen and (max-width: 768px) and (orientation: landscape) {
      #gameArea {
        width: 100vw;
        height: 100vh;
        margin: 0;
      }

      #hammerBtn {
        position: absolute;
        bottom: 15px;
        left: 15px;
        width: 100px;
        height: 40px;
        font-size: 16px;
        background: #555;
        color: #fff;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        z-index: 10;
      }
      
      #restartBtn {
        position: absolute;
        bottom: 15px;
        right: 15px;
        width: 120px;
        height: 40px;
        font-size: 16px;
        background: #444;
        color: #fff;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        z-index: 10;
      }
      
      #score {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 20px;
        z-index: 10;
      }
      
      #message {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 22px;
        color: #f66;
        z-index: 10;
      }
    }
  </style>
</head>
<body>
  <h1>æš‡ã¤ã¶ã—</h1>

  <!-- ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆåˆå›è¡¨ç¤ºï¼‰ -->
  <div id="ruleOverlay">
    <div id="overlayContent">
      <h2>éŠã³æ–¹</h2>
      <p>æš‡ã‚’å©ã„ã¦ã‚¹ã‚³ã‚¢ã‚’ç¨¼ã”ã†ï¼</p>
      <p>é¢ç›®ãƒ»è¦ã‚’å©ãã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</p>
      <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
  </div>

  <!-- ç¸¦ç”»é¢è­¦å‘Šã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã‚¹ãƒãƒ›å‘ã‘ï¼‰ -->
  <div id="orientationOverlay">
    <div>
      <h2>æ¨ªç”»é¢ã«ã—ã¦ãã ã•ã„</h2>
      <p>ã‚¹ãƒãƒ›ã‚’æ¨ªã«å›ã—ã¦éŠã‚“ã§ã­</p>
    </div>
  </div>

  <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="messageOverlay">
    <div id="messageContent">
      <div id="messageText"></div>
      <button id="overlayRestartBtn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
  </div>

  <div id="gameArea">
    <div id="plate"></div>
    <div id="hammer">ğŸ”¨</div>

    <!-- ãƒœã‚¿ãƒ³ã‚’ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢å†…ã«é…ç½® -->
    <input type="button" id="hammerBtn" value="ãŸãŸã">
    <!--<button id="restartBtn">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>-->

    <!-- ã‚¹ã‚³ã‚¢ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚ã‚²ãƒ¼ãƒ ã‚¨ãƒªã‚¢å†…ã« -->
    <div id="score">ã‚¹ã‚³ã‚¢: 0</div>
    <div id="message"></div>
  </div>

  <script>
    // --- çŠ¶æ…‹ ---
    let score = 0;
    let speed = 2;        // æµã‚Œã‚‹é€Ÿã•ï¼ˆ15msã”ã¨ã®pxï¼‰
    let gameOver = false;
    const gameArea = document.getElementById("gameArea");
    const hammerBtn = document.getElementById("hammerBtn");
    //const restartBtn = document.getElementById("restartBtn");
    const scoreDisplay = document.getElementById("score");
    const messageDisplay = document.getElementById("message");
    const plate = document.getElementById("plate");
    const hammer = document.getElementById("hammer");
    const ruleOverlay = document.getElementById("ruleOverlay");
    const orientationOverlay = document.getElementById("orientationOverlay");
    const startBtn = document.getElementById("startBtn");
    const messageOverlay = document.getElementById("messageOverlay");
    const messageText = document.getElementById("messageText");
    const overlayRestartBtn = document.getElementById("overlayRestartBtn");

    let words = [];
    let spawnTimeout;

    // --- ç”Ÿæˆ ---
    function spawnWord() {
      if (gameOver) return;
      const word = document.createElement("div");
      word.className = "word";

      // å‡ºç¾ç¢ºç‡
      const r = Math.random();
      word.textContent = r < 0.7 ? "æš‡" : r < 0.9 ? "é¢ç›®" : "è¦";

      // å³ç«¯ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
      word.style.left = gameArea.offsetWidth + "px";
      gameArea.appendChild(word);

      let pos = gameArea.offsetWidth;
      const interval = setInterval(() => {
        if (gameOver) { clearInterval(interval); return; }
        pos -= speed;
        word.style.left = pos + "px";

        // å·¦ç«¯ã«åˆ°é”
        if (pos <= 0) {
          clearInterval(interval);
          if (word.parentNode === gameArea) gameArea.removeChild(word);
          if (word.textContent === "æš‡") {
            endGame(`æš‡ãŒ${score}æ½°ã‚Œã¾ã—ãŸ`);
          }
        }
      }, 15);

      words.push({ el: word, interval });
      // å‡ºç¾é–“éš”ï¼ˆé€Ÿã‚ï¼‰
      spawnTimeout = setTimeout(spawnWord, 500 + Math.random() * 300);
    }

    // --- çµ‚äº†å‡¦ç† ---
    function endGame(msg) {
      gameOver = true;
      clearTimeout(spawnTimeout);
      messageText.textContent = msg;
      messageOverlay.style.display = "flex"; // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º
    }
    
    overlayRestartBtn.onclick = () => {
      messageOverlay.style.display = "none"; // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ¶ˆã™
      startGame(); // ã‚²ãƒ¼ãƒ å†é–‹
    };

    // --- ç ´ç •æ¼”å‡º ---
    function shatterWord(wordEl) {
      const text = wordEl.textContent;
      const rect = wordEl.getBoundingClientRect();
      const areaRect = gameArea.getBoundingClientRect();
      const x = rect.left - areaRect.left;
      const y = rect.top - areaRect.top;

      if (wordEl.parentNode === gameArea) gameArea.removeChild(wordEl);

      for (let i = 0; i < text.length; i++) {
        const span = document.createElement("span");
        span.textContent = text[i];
        span.style.position = "absolute";
        span.style.left = (x + i * 10) + "px";
        span.style.top = y + "px";
        span.style.fontSize = "24px";
        span.style.color = "#ff0";
        gameArea.appendChild(span);

        const dx = (Math.random() - 0.5) * 200;
        const dy = (Math.random() - 0.5) * 100;

        span.animate(
          [
            { transform: "translate(0,0)", opacity: 1 },
            { transform: `translate(${dx}px, ${dy}px) rotate(${Math.random()*360}deg)`, opacity: 0 }
          ],
          { duration: 800, easing: "ease-out", fill: "forwards" }
        );

        setTimeout(() => {
          if (span.parentNode === gameArea) gameArea.removeChild(span);
        }, 900);
      }
    }

    // --- å©ãå‡¦ç† ---
    function tryHit() {
      if (gameOver) return;
      hammer.classList.add("down");

      setTimeout(() => {
        hammer.classList.remove("down");
        const plateRect = plate.getBoundingClientRect();
        let hitIndex = -1;

        // ãƒ’ãƒƒãƒˆåˆ¤å®šï¼ˆXè»¸é‡ãªã‚Šï¼‰
        for (let i = 0; i < words.length; i++) {
          const w = words[i];
          const rect = w.el.getBoundingClientRect();
          const overlaps =
            !(rect.right < plateRect.left || rect.left > plateRect.right);

          if (overlaps) { hitIndex = i; break; }
        }

        if (hitIndex >= 0) {
          const w = words[hitIndex];

          if (w.el.textContent === "æš‡") {
            score += 10;
            scoreDisplay.textContent = "ã‚¹ã‚³ã‚¢: " + score;
            shatterWord(w.el);
            clearInterval(w.interval);
            words.splice(hitIndex, 1);
          } else if (w.el.textContent === "é¢ç›®") {
            shatterWord(w.el);
            clearInterval(w.interval);
            words.splice(hitIndex, 1);
            endGame("ğŸ˜­é¢ç›®ä¸¸æ½°ã‚ŒğŸ˜­");
          } else if (w.el.textContent === "è¦") {
            shatterWord(w.el);
            clearInterval(w.interval);
            words.splice(hitIndex, 1);
            messageDisplay.style.color = "red";
            endGame("ğŸ¦å‹•ç‰©è™å¾…åå¯¾ï¼ğŸ¦");
          }
        }
      }, 80);
    }

    hammerBtn.addEventListener("click", tryHit);
    // ã‚¿ãƒƒãƒç«¯æœ«ã§ã‚‚åå¿œè‰¯ã
    hammerBtn.addEventListener("touchstart", (e) => { e.preventDefault(); tryHit(); }, { passive: false });

    // --- é–‹å§‹ãƒ»å†é–‹ ---
    function startGame() {
      score = 0;
      speed = 2;
      gameOver = false;
      scoreDisplay.textContent = "ã‚¹ã‚³ã‚¢: 0";
      messageOverlay.style.display = "none"; // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤éè¡¨ç¤º
      words.forEach(w => {
        clearInterval(w.interval);
        if (w.el.parentNode === gameArea) gameArea.removeChild(w.el);
      });
      words = [];
      spawnWord();
    }

    //restartBtn.addEventListener("click", startGame);

    // --- ç”»é¢å‘ãã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã‚¹ãƒãƒ›ã®ã¿æœ‰åŠ¹ã«ã—ãŸã„æ™‚ã¯æ¡ä»¶è¿½åŠ å¯ï¼‰ ---
    function checkOrientation() {
      if (!orientationOverlay) return;
      const isPortrait = window.innerHeight > window.innerWidth;
      orientationOverlay.style.display = isPortrait ? "flex" : "none";
    }
    window.addEventListener("resize", checkOrientation);
    window.addEventListener("orientationchange", checkOrientation);

    // --- åˆæœŸè¡¨ç¤ºï¼šãƒ«ãƒ¼ãƒ«ã‚’è¦‹ã›ã¦ã‹ã‚‰é–‹å§‹ ---
    function showRules() {
      if (ruleOverlay) ruleOverlay.style.display = "flex";
    }
    function hideRules() {
      if (ruleOverlay) ruleOverlay.style.display = "none";
    }
    if (startBtn) {
      startBtn.addEventListener("click", () => {
        hideRules();
        checkOrientation(); // ã‚¹ãƒãƒ›ç¸¦ãªã‚‰è­¦å‘Šã€æ¨ªãªã‚‰é–‹å§‹
        if (orientationOverlay && orientationOverlay.style.display === "none") {
          startGame();
        }
      });
    }

    // ã‚¹ãƒãƒ›ãŒç¸¦â†’æ¨ªã«ãªã£ãŸã‚‰è‡ªå‹•ã§é–‹å§‹ï¼ˆã¾ã é–‹å§‹ã—ã¦ã„ãªã„å ´åˆï¼‰
    orientationOverlay.addEventListener("click", () => {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ã®é–‰ã˜ã¯è¨±å¯ã—ãªã„ï¼ˆå‘ããŒå¤‰ã‚ã£ãŸã‚‰æ¶ˆãˆã‚‹ï¼‰
    });
    window.addEventListener("orientationchange", () => {
      const wasClosed = orientationOverlay && orientationOverlay.style.display === "none";
      if (!gameOver && words.length === 0 && wasClosed) {
        // ã¾ã ã‚²ãƒ¼ãƒ æœªé–‹å§‹ãªã‚‰é–‹å§‹
        startGame();
      }
    });

    // æœ€åˆã«ãƒ«ãƒ¼ãƒ«è¡¨ç¤º
    showRules();
    // èµ·å‹•æ™‚ã®å‘ããƒã‚§ãƒƒã‚¯
    checkOrientation();
  </script>
</body>
</html>
